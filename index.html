<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador Metodo MAG - Offline</title>
    <!-- Librer√≠as CSS y JS externas para estilos y funcionalidad -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* Estilos personalizados para la aplicaci√≥n */
        body { font-family: 'Inter', sans-serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .gradient-bg { background: linear-gradient(135deg, #fce7f3 0%, #e9d5ff 100%); }
        .card { background: white; border-radius: 0.5rem; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); }
        .btn-primary { background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%); color: white; }
        .btn-primary:hover { opacity: 0.9; }
        .input-field { border: 1px solid #d1d5db; border-radius: 0.375rem; padding: 0.5rem; }
        .table { width: 100%; border-collapse: collapse; }
        .table th, .table td { padding: 0.5rem; text-align: left; border-bottom: 1px solid #e5e7eb; }
    </style>
</head>
<body class="gradient-bg min-h-screen p-4">
    <!-- Contenedor principal de la aplicaci√≥n -->
    <div class="max-w-7xl mx-auto">
        <!-- Header con t√≠tulo y bot√≥n de guardar -->
        <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-6 rounded-xl shadow-lg mb-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <img src="https://crisballoons.com/wp-content/uploads/2023/04/Copia-de-Maestria-5-e1682776121486-300x141.png" alt="Cris Balloons Logo" class="h-16 w-auto">
                    <div>
                        <h1 class="text-3xl font-bold flex items-center gap-2">Cotizador</h1>
                        <p class="text-pink-100 mt-2">Costos y presupuestos m√©todo MAG - Versi√≥n Offline</p>
                    </div>
                </div>
                <button id="saveDataBtn" class="bg-white text-pink-600 px-4 py-2 rounded-lg font-semibold hover:bg-pink-50">Guardar Datos</button>
            </div>
        </div>

        <!-- √Årea para mostrar mensajes de estado -->
        <div id="messageStatus" class="mb-4"></div>

        <!-- Navegaci√≥n por tabs -->
        <div class="bg-white rounded-lg shadow-md mb-6">
            <div class="flex border-b">
                <button class="tab-btn active px-4 py-2 border-b-2 border-pink-500 text-pink-600" data-tab="config">Configuraci√≥n</button>
                <button class="tab-btn px-4 py-2 text-gray-600" data-tab="cliente">Cliente</button>
                <button class="tab-btn px-4 py-2 text-gray-600" data-tab="materiales">Materiales</button>
                <button class="tab-btn px-4 py-2 text-gray-600" data-tab="gastos">Gastos Extra</button>
                <button class="tab-btn px-4 py-2 text-gray-600" data-tab="rentabilidad">Rentabilidad</button>
                <button class="tab-btn px-4 py-2 text-gray-600" data-tab="pdf">PDF</button>
                <button class="tab-btn px-4 py-2 text-gray-600" data-tab="ayuda">Ayuda</button>
            </div>
        </div>

        <!-- Contenido de las tabs -->
        <div id="config" class="tab-content active">
            <div class="card p-6">
                <h2 class="text-xl font-bold mb-4">Configuraci√≥n de Empresa</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="empresa" class="block text-sm font-medium mb-1">Empresa</label>
                        <input id="empresa" class="input-field w-full" placeholder="Floral Dreams">
                    </div>
                    <div>
                        <label for="telefono" class="block text-sm font-medium mb-1">Tel√©fono</label>
                        <input id="telefono" class="input-field w-full" placeholder="555-1234">
                    </div>
                    <div>
                        <label for="direccion" class="block text-sm font-medium mb-1">Direcci√≥n</label>
                        <input id="direccion" class="input-field w-full" placeholder="Calle Flores 123">
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium mb-1">Email</label>
                        <input id="email" class="input-field w-full" placeholder="info@empresa.com">
                    </div>
                    <div>
                        <label for="eslogan" class="block text-sm font-medium mb-1">Eslogan</label>
                        <input id="eslogan" class="input-field w-full" placeholder="Creando momentos m√°gicos">
                    </div>
                    <div>
                        <label for="logo" class="block text-sm font-medium mb-1">Logo (Imagen)</label>
                        <input id="logo" type="file" accept="image/*" class="input-field w-full">
                        <p class="text-xs text-gray-500 mt-1">Selecciona una imagen para el logo en el PDF</p>
                        <div id="logoPreview" class="mt-2"></div>
                    </div>
                </div>
                <div class="mt-4">
                    <label for="idioma" class="block text-sm font-medium mb-1">Idioma</label>
                    <select id="idioma" class="input-field">
                        <option value="es">Espa√±ol</option>
                        <option value="en">English</option>
                        <option value="fr">Fran√ßais</option>
                    </select>
                </div>
                <div class="mt-4">
                    <label for="moneda" class="block text-sm font-medium mb-1">Moneda</label>
                    <select id="moneda" class="input-field">
                        <option value="COP">COP</option>
                        <option value="USD">USD</option>
                        <option value="EUR">EUR</option>
                        <option value="CAD">CAD</option>
                        <option value="GBP">GBP</option>
                    </select>
                </div>
            </div>
        </div>

        <div id="cliente" class="tab-content">
            <div class="card p-6">
                <h2 class="text-xl font-bold mb-4">Informaci√≥n del Cliente</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="clienteNombre" class="block text-sm font-medium mb-1">Nombre</label>
                        <input id="clienteNombre" class="input-field w-full">
                    </div>
                    <div>
                        <label for="tipoServicio" class="block text-sm font-medium mb-1">Tipo de Servicio</label>
                        <input id="tipoServicio" class="input-field w-full">
                    </div>
                    <div>
                        <label for="fechaCotizacion" class="block text-sm font-medium mb-1">Fecha de Cotizaci√≥n</label>
                        <input id="fechaCotizacion" type="date" class="input-field w-full">
                    </div>
                    <div>
                        <label for="fechaDecoracion" class="block text-sm font-medium mb-1">Fecha de Decoraci√≥n</label>
                        <input id="fechaDecoracion" type="date" class="input-field w-full">
                    </div>
                    <div>
                        <label for="lugarDecoracion" class="block text-sm font-medium mb-1">Lugar de Decoraci√≥n</label>
                        <input id="lugarDecoracion" class="input-field w-full">
                    </div>
                    <div>
                        <label for="clienteEmail" class="block text-sm font-medium mb-1">Email</label>
                        <input id="clienteEmail" type="email" class="input-field w-full">
                    </div>
                    <div>
                        <label for="contacto" class="block text-sm font-medium mb-1">Contacto</label>
                        <input id="contacto" class="input-field w-full">
                    </div>
                </div>
                <div class="mt-4">
                    <label for="descripcion" class="block text-sm font-medium mb-1">Descripci√≥n</label>
                    <textarea id="descripcion" class="input-field w-full" rows="3"></textarea>
                </div>
                <div class="mt-4">
                    <label for="notas" class="block text-sm font-medium mb-1">Notas</label>
                    <textarea id="notas" class="input-field w-full" rows="3"></textarea>
                </div>
            </div>
        </div>

        <div id="materiales" class="tab-content">
            <div class="card p-6">
                <h2 class="text-xl font-bold mb-4">Materiales</h2>
                <button id="addMaterial" class="btn-primary px-4 py-2 rounded mb-4">Agregar Material</button>
                <div id="materialsList"></div>
            </div>
        </div>

        <div id="gastos" class="tab-content">
            <div class="card p-6">
                <h2 class="text-xl font-bold mb-4">Gastos Adicionales</h2>
                <button id="addExpense" class="btn-primary px-4 py-2 rounded mb-4">Agregar Gasto</button>
                <div id="expensesList"></div>
            </div>
        </div>

        <div id="rentabilidad" class="tab-content">
            <div class="card p-6">
                <h2 class="text-xl font-bold mb-4">C√°lculos de Rentabilidad</h2>
                <div class="mb-6">
                    <h3 id="laborCalcTitle" class="text-lg font-semibold mb-2">C√°lculo de Mano de Obra</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th id="conceptTh">Concepto</th>
                                <th id="totalMaterialsTh">Total Materiales</th>
                                <th id="laborPctTh">% Mano de Obra</th>
                                <th id="totalLaborTh">Total Mano de Obra</th>
                            </tr>
                        </thead>
                        <tbody id="manoObraTable">
                            <tr>
                                <td id="laborTd">Mano de Obra</td>
                                <td id="totalMaterialesDisplay">-</td>
                                <td><input id="manoObraPctInput" type="number" step="0.01" class="input-field w-full" value="30"></td>
                                <td id="totalManoObraDisplay">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="mb-6">
                    <h3 id="assistantsTitle" class="text-lg font-semibold mb-2">Asistentes</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th id="assistant1Th">Asistente 1</th>
                                <th id="assistant2Th">Asistente 2</th>
                                <th id="assistant3Th">Asistente 3</th>
                                <th id="assistant4Th">Asistente 4</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input id="asistente1" type="number" step="0.01" class="input-field w-full"></td>
                                <td><input id="asistente2" type="number" step="0.01" class="input-field w-full"></td>
                                <td><input id="asistente3" type="number" step="0.01" class="input-field w-full"></td>
                                <td><input id="asistente4" type="number" step="0.01" class="input-field w-full"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="mb-6">
                    <h3 id="profitSettlementTitle" class="text-lg font-semibold mb-2">Liquidaci√≥n de Rentabilidad</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th id="conceptRentTh">Concepto</th>
                                <th id="profitPctTh">% Rentabilidad</th>
                                <th id="totalCostsTh">Total de Costos</th>
                                <th id="myProfitTh">Mi Ganancia</th>
                                <th id="decorationValueTh">Valor Decoracion</th>
                                <th id="additionalExpensesTh">Gastos Adicionales</th>
                                <th id="totalWithoutTaxTh">Total sin Impuesto</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td id="profitTd">Rentabilidad</td>
                                <td><input id="rentabilidadPct" type="number" step="0.01" class="input-field w-full" value="45"></td>
                                <td id="totalCostosDisplay">-</td>
                                <td id="miGananciaDisplay">-</td>
                                <td id="subtotalFinalDisplay">-</td>
                                <td id="gastosAdicionalesDisplay">-</td>
                                <td id="valorTotalDisplay">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="mt-6">
                    <h3 id="taxSettlementTitle" class="text-lg font-semibold mb-2">Liquidaci√≥n de Impuestos</h3>
                    <div class="grid grid-cols-1 md:grid-cols-6 gap-4 mb-4">
                        <div>
                            <label for="nombreImpuesto" class="block text-sm font-medium mb-1">Nombre del Impuesto</label>
                            <input id="nombreImpuesto" type="text" class="input-field w-full" value="IVA">
                        </div>
                        <div>
                            <label for="tasaImpuesto" class="block text-sm font-medium mb-1">Porcentaje de Impuesto (%)</label>
                            <input id="tasaImpuesto" type="number" step="0.01" class="input-field w-full" value="19">
                        </div>
                        <div>
                            <label for="tipoImpuesto" class="block text-sm font-medium mb-1">Tipo de Impuesto</label>
                            <select id="tipoImpuesto" class="input-field">
                                <option value="excluido">Excluido</option>
                                <option value="incluido">Incluido</option>
                                <option value="noimpuesto">Sin Impuesto</option>
                            </select>
                        </div>
                        <div>
                            <label id="baseImponibleLabel" class="block text-sm font-medium mb-1">Base Imponible</label>
                            <div id="baseImponibleDisplay" class="px-3 py-2 bg-white border border-gray-300 rounded text-center font-medium"></div>
                        </div>
                        <div>
                            <label id="impuestoLabel" class="block text-sm font-medium mb-1">Monto del Impuesto</label>
                            <div id="impuestoDisplay" class="px-3 py-2 bg-white border border-gray-300 rounded text-center font-medium"></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-6 gap-4 mb-4">
                        <div>
                          <!--  <label for="nombreImpuesto2" class="block text-sm font-medium mb-1">Nombre del Segundo Impuesto</label> -->
                            <input id="nombreImpuesto2" type="text" class="input-field w-full" value="">
                        </div>
                        <div>
                           <!-- <label for="tasaImpuesto2" class="block text-sm font-medium mb-1">Porcentaje de Impuesto (%)</label> -->
                            <input id="tasaImpuesto2" type="number" step="0.01" class="input-field w-full" value="0">
                        </div>
                        <div>
                           <!-- <label for="tipoImpuesto2" class="block text-sm font-medium mb-1">Tipo de Impuesto</label> -->
                            <select id="tipoImpuesto2" class="input-field">
                                <option value="excluido">Excluido</option>
                                <option value="incluido">Incluido</option>
                                <option value="noimpuesto">Sin Impuesto</option>
                            </select>
                        </div>
                        <div>
                          <!--  <label id="baseImponibleLabel2" class="block text-sm font-medium mb-1">Base Imponible</label> -->
                            <div id="baseImponibleDisplay2" class="px-3 py-2 bg-white border border-gray-300 rounded text-center font-medium"></div>
                        </div>
                        <div>
                          <!--  <label id="impuestoLabel2" class="block text-sm font-medium mb-1">Monto del Impuesto</label> -->
                            <div id="impuestoDisplay2" class="px-3 py-2 bg-white border border-gray-300 rounded text-center font-medium"></div>
                        </div>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-6 rounded-xl shadow-lg mb-6 text-center">
                    <h3 id="totalWithTaxTitle" class="text-xl font-bold mb-4">Total por cobrar</h3>
                    <div class="text-3xl font-extrabold" id="totalConImpuestoGrande"></div>
                </div>
            </div>
        </div>

        <div id="pdf" class="tab-content">
            <div class="card p-6">
                <h2 class="text-xl font-bold mb-4">Generar PDF</h2>
                <button id="generatePDF" class="btn-primary px-4 py-2 rounded">Generar y Descargar PDF</button>
                <div id="pdfStatus" class="mt-4"></div>
                <hr class="my-4">
           <!--     <h3 class="text-lg font-semibold mb-2">Debug localStorage</h3>
                <div class="flex gap-2 flex-wrap">
                    <button id="debugBtn" class="btn-secondary px-3 py-2 rounded text-sm">Verificar Datos</button>
                    <button id="testDataBtn" class="btn-secondary px-3 py-2 rounded text-sm">Cargar Datos de Prueba</button>
                    <button id="clearDataBtn" class="btn-secondary px-3 py-2 rounded text-sm">Limpiar Datos</button>
                </div>
                <div id="debugStatus" class="mt-2 text-sm"></div> -->
            </div>
        </div>

        <div id="ayuda" class="tab-content">
            <div class="card p-6">
                <h2 class="text-xl font-bold mb-4">Ayuda - Gu√≠a de Uso</h2>
                <div class="prose max-w-none">
                    <h3 class="text-lg font-semibold mb-2">1. Configuraci√≥n</h3>
                    <p class="mb-4">En esta secci√≥n configura la informaci√≥n de tu empresa. Completa los campos de Empresa, Tel√©fono, Direcci√≥n, Email, Eslogan y selecciona un Logo si deseas. Tambi√©n elige el Idioma y la Moneda para la cotizaci√≥n.</p>

                    <h3 class="text-lg font-semibold mb-2">2. Cliente</h3>
                    <p class="mb-4">Ingresa los datos del cliente: Nombre, Tipo de Servicio, Fechas de Cotizaci√≥n y Decoraci√≥n, Lugar de Decoraci√≥n, Email, Contacto, Descripci√≥n del servicio y Notas adicionales.</p>

                    <h3 class="text-lg font-semibold mb-2">3. Materiales</h3>
                    <p class="mb-4">Agrega los materiales necesarios para la decoraci√≥n. Para cada material, especifica el Concepto, Cantidad y Precio Unitario. El subtotal se calcula autom√°ticamente. Usa el bot√≥n "Agregar Material" para a√±adir m√°s filas.</p>

                    <h3 class="text-lg font-semibold mb-2">4. Gastos Extra</h3>
                    <p class="mb-4">Incluye cualquier gasto adicional no relacionado con materiales, como transporte o alquiler de equipo. Agrega Concepto y Precio para cada gasto.</p>

                    <h3 class="text-lg font-semibold mb-2">5. Rentabilidad</h3>
                    <p class="mb-4">Configura los porcentajes de Mano de Obra y Rentabilidad. Agrega los costos de Asistentes si aplica. Revisa el c√°lculo de impuestos: puedes configurar hasta dos impuestos con diferentes tasas. El sistema calcula autom√°ticamente el total con impuestos.</p>

                    <h3 class="text-lg font-semibold mb-2">6. PDF</h3>
                    <p class="mb-4">Genera y descarga la cotizaci√≥n en formato PDF. El PDF incluir√° toda la informaci√≥n configurada: datos de empresa, cliente, materiales, gastos, c√°lculos de rentabilidad e impuestos.</p>

                    <h3 class="text-lg font-semibold mb-2">Guardar Datos</h3>
                    <p class="mb-4">Usa el bot√≥n "Guardar Datos" en la parte superior para almacenar toda la informaci√≥n localmente en tu navegador. Los datos se mantendr√°n entre sesiones.</p>

                    <h3 class="text-lg font-semibold mb-2">T√©rminos y Condiciones de Uso</h3>
                    <p class="mb-4">Esta aplicaci√≥n es proporcionada "tal cual" sin garant√≠as de ning√∫n tipo. El uso de esta herramienta es bajo tu propia responsabilidad. No nos hacemos responsables por p√©rdidas de datos, errores en c√°lculos o cualquier da√±o derivado de su uso.</p>

                    <h3 class="text-lg font-semibold mb-2">Propiedad Intelectual</h3>
                    <p class="mb-4">Esta aplicaci√≥n y su c√≥digo fuente son propiedad de CG DECORACIONES GROUP SAS. Todos los derechos reservados. No se permite la copia, modificaci√≥n o distribuci√≥n sin autorizaci√≥n expresa. Las marcas y logos utilizados son propiedad de sus respectivos due√±os.</p>

                    <h3 class="text-lg font-semibold mb-2">Privacidad de Datos</h3>
                    <p class="mb-4">Todos los datos ingresados se almacenan localmente en tu navegador. No se transmiten a servidores externos ni se comparten con terceros. Es tu responsabilidad mantener la confidencialidad de la informaci√≥n.</p>

                    <h3 class="text-lg font-semibold mb-2">Limitaci√≥n de Responsabilidad</h3>
                    <p class="mb-4">En ning√∫n caso seremos responsables por da√±os directos, indirectos, incidentales o consecuentes derivados del uso de esta aplicaci√≥n. El usuario asume toda responsabilidad por la precisi√≥n de los datos y c√°lculos realizados.</p>

                    <p class="text-sm text-gray-600 mt-6">Esta aplicaci√≥n funciona completamente offline una vez cargada. Aseg√∫rate de tener conexi√≥n a internet solo para la carga inicial de la librer√≠a jsPDF.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // C√≥digo JavaScript para el Cotizador de Globos Offline
        // Maneja el estado de la aplicaci√≥n, c√°lculos, persistencia y generaci√≥n de PDF
        // Estado global de la aplicaci√≥n: contiene toda la informaci√≥n del cotizador
        let state = {
            // Configuraci√≥n de la empresa
            companyConfig: {
                empresa: 'CrisBalloons',
                direccion: 'Calle Flores 123, Ciudad',
                telefono: '555-1234',
                eslogan: 'Creando momentos m√°gicos con globos',
                email: 'info@empresa.com',
                logoBase64: null // Imagen del logo en base64
            },
            // Datos del cliente
            clientData: {
                nombre: '',
                tipoServicio: '',
                descripcion: '',
                fechaDecoracion: '',
                lugarDecoracion: '',
                email: '',
                contacto: '',
                notas: '',
                fechaCotizacion: ''
            },
            // Lista de materiales
            materials: [],
            // Lista de gastos indirectos
            expenses: [],
            // Par√°metros de c√°lculo
            calculations: {
                nombreImpuesto: 'IVA',
                tasaImpuesto: 19,
                tipoImpuesto: 'excluido',
                nombreImpuesto2: '',
                tasaImpuesto2: 0,
                tipoImpuesto2: 'excluido',
                manoObraPct: 30,
                rentabilidadPct: 45,
                asistente1: 0,
                asistente2: 0,
                asistente3: 0,
                asistente4: 0
            },
            // Idioma y moneda seleccionados
            idioma: 'es',
            moneda: 'COP'
        };

        // Traducciones para la interfaz de usuario
        const uiTranslations = {
            es: {
                title: 'Cotizador',
                subtitle: 'Costos y presupuestos m√©todo MAG - Versi√≥n Offline',
                saveData: 'Guardar Datos',
                configTab: 'Configuraci√≥n',
                clientTab: 'Cliente',
                materialsTab: 'Materiales',
                expensesTab: 'Gastos',
                profitabilityTab: 'Rentabilidad',
                pdfTab: 'PDF',
                helpTab: 'Ayuda',
                companyConfig: 'Configuraci√≥n de Empresa',
                companyName: 'Empresa',
                phone: 'Tel√©fono',
                address: 'Direcci√≥n',
                email: 'Email',
                slogan: 'Eslogan',
                logo: 'Logo (Imagen)',
                logoDesc: 'Selecciona una imagen para el logo en el PDF',
                language: 'Idioma',
                currency: 'Moneda',
                clientInfo: 'Informaci√≥n del Cliente',
                clientName: 'Nombre',
                serviceType: 'Tipo de Servicio',
                description: 'Descripci√≥n',
                decorationDate: 'Fecha de Decoraci√≥n',
                decorationPlace: 'Lugar de Decoraci√≥n',
                clientEmail: 'Email',
                contact: 'Contacto',
                notes: 'Notas',
                quotationDate: 'Fecha de Cotizaci√≥n',
                materials: 'Materiales',
                addMaterial: 'Agregar Material',
                materialConcept: 'Concepto',
                materialQuantity: 'Cantidad',
                materialUnitPrice: 'Precio Unit.',
                materialSubtotal: 'Subtotal',
                indirectExpenses: 'Gastos Adicionales',
                addExpense: 'Agregar Gasto',
                expenseConcept: 'Concepto',
                expensePrice: 'Precio',
                profitabilityCalc: 'C√°lculos de Rentabilidad',
                laborCalc: 'C√°lculo de Mano de Obra',
                concept: 'Concepto',
                totalMaterials: 'Total Materiales',
                laborPct: '% Mano de Obra',
                totalLabor: 'Total Mano de Obra',
                labor: 'Mano de Obra',
                assistants: 'Asistentes',
                assistant1: 'Asistente 1',
                assistant2: 'Asistente 2',
                assistant3: 'Asistente 3',
                assistant4: 'Asistente 4',
                profitSettlement: 'Liquidaci√≥n de Rentabilidad',
                profitPct: '% Rentabilidad',
                totalCosts: 'Total de Costos',
                myProfit: 'Mi Ganancia',
                decorationValue: 'Valor Decoraci√≥n',
                additionalExpenses: 'Gastos Adicionales',
                totalWithoutTax: 'Total sin Impuesto',
                profit: 'Rentabilidad',
                quantity: 'Cantidad',
                unitCost: 'Costo Unitario',
                taxes: 'Porcentaje de Impuesto (%)',
                taxType: 'Tipo de Impuesto',
                included: 'Incluido',
                excluded: 'Excluido',
                taxSettlement: 'Liquidaci√≥n de Impuestos',
                taxableBase: 'Base Imponible',
                taxAmount: 'Monto del Impuesto',
                totalWithTax: 'Total con Impuesto',
                noTax: 'Sin Impuesto',
                taxName: 'Nombre del Impuesto',
                laborPct: 'Mano de Obra (%)',
                profitPct: 'Rentabilidad (%)',
                assistant1: 'Asistente 1',
                assistant2: 'Asistente 2',
                assistant3: 'Asistente 3',
                assistant4: 'Asistente 4',
                results: 'Resultados',
                totalMaterials: 'Total Materiales',
                totalLabor: 'Total Mano de Obra',
                totalAssistants: 'Total Asistentes',
                totalExpenses: 'Total Gastos',
                totalCosts: 'Total Costos',
                myProfit: 'Mi Ganancia',
                finalPrice: 'Precio Final',
                generatePDF: 'Generar y Descargar PDF',
                dataSaved: 'Datos guardados satisfactoriamente en la base de datos local.',
                generatingPDF: 'Generando PDF...',
                pdfGenerated: 'PDF generado exitosamente!'
            },
            en: {
                title: 'Quoter',
                subtitle: 'Costs and budgets MAG method - Offline Version',
                saveData: 'Save Data',
                configTab: 'Configuration',
                clientTab: 'Client',
                materialsTab: 'Materials',
                expensesTab: 'Expenses',
                profitabilityTab: 'Profitability',
                pdfTab: 'PDF',
                helpTab: 'Help',
                companyConfig: 'Company Configuration',
                companyName: 'Company',
                phone: 'Phone',
                address: 'Address',
                email: 'Email',
                slogan: 'Slogan',
                logo: 'Logo (Image)',
                logoDesc: 'Select an image for the logo in the PDF',
                language: 'Language',
                currency: 'Currency',
                clientInfo: 'Client Information',
                clientName: 'Name',
                serviceType: 'Service Type',
                description: 'Description',
                decorationDate: 'Decoration Date',
                decorationPlace: 'Decoration Place',
                clientEmail: 'Email',
                contact: 'Contact',
                notes: 'Notes',
                quotationDate: 'Quotation Date',
                materials: 'Materials',
                addMaterial: 'Add Material',
                materialConcept: 'Concept',
                materialQuantity: 'Quantity',
                materialUnitPrice: 'Unit Price',
                materialSubtotal: 'Subtotal',
                indirectExpenses: 'Additional Expenses',
                addExpense: 'Add Expense',
                expenseConcept: 'Concept',
                expensePrice: 'Price',
                profitabilityCalc: 'Profitability Calculations',
                laborCalc: 'Labor Calculation',
                concept: 'Concept',
                totalMaterials: 'Total Materials',
                laborPct: '% Labor',
                totalLabor: 'Total Labor',
                labor: 'Labor',
                assistants: 'Assistants',
                assistant1: 'Assistant 1',
                assistant2: 'Assistant 2',
                assistant3: 'Assistant 3',
                assistant4: 'Assistant 4',
                profitSettlement: 'Profit Settlement',
                profitPct: '% Profitability',
                totalCosts: 'Total Costs',
                myProfit: 'My Profit',
                decorationValue: 'Decoration Value',
                additionalExpenses: 'Additional Expenses',
                totalWithoutTax: 'Total without Tax',
                profit: 'Profitability',
                quantity: 'Quantity',
                unitCost: 'Unit Cost',
                taxes: 'Tax Percentage (%)',
                taxType: 'Tax Type',
                included: 'Included',
                excluded: 'Excluded',
                taxSettlement: 'Tax Settlement',
                taxableBase: 'Taxable Base',
                taxAmount: 'Tax Amount',
                totalWithTax: 'Total with Tax',
                noTax: 'No Tax',
                taxName: 'Tax Name',
                laborPct: 'Labor (%)',
                profitPct: 'Profitability (%)',
                assistant1: 'Assistant 1',
                assistant2: 'Assistant 2',
                assistant3: 'Assistant 3',
                assistant4: 'Assistant 4',
                results: 'Results',
                totalMaterials: 'Total Materials',
                totalLabor: 'Total Labor',
                totalAssistants: 'Total Assistants',
                totalExpenses: 'Total Expenses',
                totalCosts: 'Total Costs',
                myProfit: 'My Profit',
                finalPrice: 'Final Price',
                generatePDF: 'Generate and Download PDF',
                dataSaved: 'Data saved successfully in local database.',
                generatingPDF: 'Generating PDF...',
                pdfGenerated: 'PDF generated successfully!'
            },
            fr: {
                title: 'Devis',
                subtitle: 'Co√ªts et budgets m√©thode MAG - Version Hors Ligne',
                saveData: 'Sauvegarder les Donn√©es',
                configTab: 'Configuration',
                clientTab: 'Client',
                materialsTab: 'Mat√©riaux',
                expensesTab: 'D√©penses',
                profitabilityTab: 'Rentabilit√©',
                pdfTab: 'PDF',
                helpTab: 'Aide',
                companyConfig: 'Configuration de l\'Entreprise',
                companyName: 'Entreprise',
                phone: 'T√©l√©phone',
                address: 'Adresse',
                email: 'Email',
                slogan: 'Slogan',
                logo: 'Logo (Image)',
                logoDesc: 'S√©lectionnez une image pour le logo dans le PDF',
                language: 'Langue',
                currency: 'Devise',
                clientInfo: 'Informations Client',
                clientName: 'Nom',
                serviceType: 'Type de Service',
                description: 'Description',
                decorationDate: 'Date de D√©coration',
                decorationPlace: 'Lieu de D√©coration',
                clientEmail: 'Email',
                contact: 'Contact',
                notes: 'Notes',
                quotationDate: 'Date de Devis',
                materials: 'Mat√©riaux',
                addMaterial: 'Ajouter Mat√©riau',
                materialConcept: 'Concept',
                materialQuantity: 'Quantit√©',
                materialUnitPrice: 'Prix Unit.',
                materialSubtotal: 'Sous-total',
                indirectExpenses: 'D√©penses Additionnelles',
                addExpense: 'Ajouter D√©pense',
                expenseConcept: 'Concept',
                expensePrice: 'Prix',
                profitabilityCalc: 'Calculs de Rentabilit√©',
                laborCalc: 'Calcul de Main d\'≈ìuvre',
                concept: 'Concept',
                totalMaterials: 'Total Mat√©riaux',
                laborPct: '% Main d\'≈ìuvre',
                totalLabor: 'Total Main d\'≈ìuvre',
                labor: 'Main d\'≈ìuvre',
                assistants: 'Assistants',
                assistant1: 'Assistant 1',
                assistant2: 'Assistant 2',
                assistant3: 'Assistant 3',
                assistant4: 'Assistant 4',
                profitSettlement: 'Liquidation de Rentabilit√©',
                profitPct: '% Rentabilit√©',
                totalCosts: 'Co√ªts Totaux',
                myProfit: 'Mon Profit',
                decorationValue: 'Valeur de la D√©coration',
                additionalExpenses: 'D√©penses Additionnelles',
                totalWithoutTax: 'Total sans Imp√¥t',
                profit: 'Rentabilit√©',
                quantity: 'Quantit√©',
                unitCost: 'Co√ªt Unitaire',
                taxes: 'Pourcentage d\'Imp√¥t (%)',
                taxType: 'Type de Taxe',
                included: 'Inclus',
                excluded: 'Exclus',
                taxSettlement: 'Liquidation des Imp√¥ts',
                taxableBase: 'Base Imposable',
                taxAmount: 'Montant de l\'Imp√¥t',
                totalWithTax: 'Total avec Imp√¥t',
                noTax: 'Sans Imp√¥t',
                taxName: 'Nom de l\'Imp√¥t',
                laborPct: 'Main d\'≈ìuvre (%)',
                profitPct: 'Rentabilit√© (%)',
                assistant1: 'Assistant 1',
                assistant2: 'Assistant 2',
                assistant3: 'Assistant 3',
                assistant4: 'Assistant 4',
                results: 'R√©sultats',
                totalMaterials: 'Total Mat√©riaux',
                totalLabor: 'Total Main d\'≈ìuvre',
                totalAssistants: 'Total Assistants',
                totalExpenses: 'Total D√©penses',
                totalCosts: 'Co√ªts Totaux',
                myProfit: 'Mon Profit',
                finalPrice: 'Prix Final',
                generatePDF: 'G√©n√©rer et T√©l√©charger PDF',
                dataSaved: 'Donn√©es sauvegard√©es avec succ√®s dans la base de donn√©es locale.',
                generatingPDF: 'G√©n√©ration du PDF...',
                pdfGenerated: 'PDF g√©n√©r√© avec succ√®s!'
            }
        };

        // Funci√≥n para actualizar el idioma de la interfaz
        function updateLanguage() {
            const t = uiTranslations[state.idioma] || uiTranslations.es;
            document.querySelector('h1').textContent = t.title;
            document.querySelector('p').textContent = t.subtitle;
            document.getElementById('saveDataBtn').textContent = t.saveData;
            document.querySelector('[data-tab="config"]').textContent = t.configTab;
            document.querySelector('[data-tab="cliente"]').textContent = t.clientTab;
            document.querySelector('[data-tab="materiales"]').textContent = t.materialsTab;
            document.querySelector('[data-tab="gastos"]').textContent = t.expensesTab;
            document.querySelector('[data-tab="rentabilidad"]').textContent = t.profitabilityTab;
            document.querySelector('[data-tab="pdf"]').textContent = t.pdfTab;
            document.querySelector('[data-tab="ayuda"]').textContent = t.helpTab;
            // Config tab
            document.querySelector('#config h2').textContent = t.companyConfig;
            document.querySelector('label[for="empresa"]').textContent = t.companyName;
            document.querySelector('label[for="telefono"]').textContent = t.phone;
            document.querySelector('label[for="direccion"]').textContent = t.address;
            document.querySelector('label[for="email"]').textContent = t.email;
            document.querySelector('label[for="eslogan"]').textContent = t.slogan;
            document.querySelector('label[for="logo"]').textContent = t.logo;
            document.querySelector('#logo + p').textContent = t.logoDesc;
            document.querySelector('label[for="idioma"]').textContent = t.language;
            document.querySelector('label[for="moneda"]').textContent = t.currency;
            // Client tab
            document.querySelector('#cliente h2').textContent = t.clientInfo;
            document.querySelector('label[for="clienteNombre"]').textContent = t.clientName;
            document.querySelector('label[for="tipoServicio"]').textContent = t.serviceType;
            document.querySelector('label[for="descripcion"]').textContent = t.description;
            document.querySelector('label[for="fechaDecoracion"]').textContent = t.decorationDate;
            document.querySelector('label[for="lugarDecoracion"]').textContent = t.decorationPlace;
            document.querySelector('label[for="clienteEmail"]').textContent = t.clientEmail;
            document.querySelector('label[for="contacto"]').textContent = t.contact;
            document.querySelector('label[for="notas"]').textContent = t.notes;
            document.querySelector('label[for="fechaCotizacion"]').textContent = t.quotationDate;
            // Materials tab
            document.querySelector('#materiales h2').textContent = t.materials;
            document.getElementById('addMaterial').textContent = t.addMaterial;
            // Expenses tab
            document.querySelector('#gastos h2').textContent = t.indirectExpenses;
            document.getElementById('addExpense').textContent = t.addExpense;
            // Profitability tab
            document.querySelector('#rentabilidad h2').textContent = t.profitabilityCalc;
            document.getElementById('laborCalcTitle').textContent = t.laborCalc;
            document.getElementById('conceptTh').textContent = t.concept;
            document.getElementById('totalMaterialsTh').textContent = t.totalMaterials;
            document.getElementById('laborPctTh').textContent = t.laborPct;
            document.getElementById('totalLaborTh').textContent = t.totalLabor;
            document.getElementById('laborTd').textContent = t.labor;
            document.getElementById('assistantsTitle').textContent = t.assistants;
            document.getElementById('assistant1Th').textContent = t.assistant1;
            document.getElementById('assistant2Th').textContent = t.assistant2;
            document.getElementById('assistant3Th').textContent = t.assistant3;
            document.getElementById('assistant4Th').textContent = t.assistant4;
            document.getElementById('profitSettlementTitle').textContent = t.profitSettlement;
            document.getElementById('conceptRentTh').textContent = t.concept;
            document.getElementById('profitPctTh').textContent = t.profitPct;
            document.getElementById('totalCostsTh').textContent = t.totalCosts;
            document.getElementById('myProfitTh').textContent = t.myProfit;
            document.getElementById('decorationValueTh').textContent = t.decorationValue;
            document.getElementById('additionalExpensesTh').textContent = t.additionalExpenses;
            document.getElementById('totalWithoutTaxTh').textContent = t.totalWithoutTax;
            document.getElementById('profitTd').textContent = t.profit;
            // Tax settlement
            document.getElementById('taxSettlementTitle').textContent = t.taxSettlement;
            document.querySelector('label[for="nombreImpuesto"]').textContent = t.taxName;
            document.querySelector('label[for="tasaImpuesto"]').textContent = t.taxes;
            document.querySelector('label[for="tipoImpuesto"]').textContent = t.taxType;
            document.querySelector('#tipoImpuesto option[value="incluido"]').textContent = t.included;
            document.querySelector('#tipoImpuesto option[value="excluido"]').textContent = t.excluded;
            document.querySelector('#tipoImpuesto option[value="noimpuesto"]').textContent = t.noTax;
            document.querySelector('#tipoImpuesto2 option[value="incluido"]').textContent = t.included;
            document.querySelector('#tipoImpuesto2 option[value="excluido"]').textContent = t.excluded;
            document.querySelector('#tipoImpuesto2 option[value="noimpuesto"]').textContent = t.noTax;
            document.getElementById('baseImponibleLabel').textContent = t.taxableBase;
            document.getElementById('impuestoLabel').textContent = t.taxAmount;
            document.getElementById('totalImpuestoLabel').textContent = t.totalWithTax;
            document.getElementById('totalWithTaxTitle').textContent = t.totalWithTax;
            // PDF tab
            document.getElementById('generatePDF').textContent = t.generatePDF;

            // Re-renderizar materiales y gastos con las nuevas traducciones
            renderMaterials();
            renderExpenses();
        }

        // Cargar datos desde localStorage al iniciar la aplicaci√≥n
        function loadData() {
            const saved = localStorage.getItem('balloonsAppData');
            if (saved) {
                state = { ...state, ...JSON.parse(saved) };
            }
            updateUI();
            updateLanguage();
        }

        // Guardar datos en localStorage (base de datos local)
        function saveData() {
            localStorage.setItem('balloonsAppData', JSON.stringify(state));
            const t = uiTranslations[state.idioma] || uiTranslations.es;
            showMessage(t.dataSaved, 'success');
            console.log('Datos guardados en localStorage:', state);
        }

        // Funci√≥n de debug para verificar localStorage
        function debugLocalStorage() {
            const saved = localStorage.getItem('balloonsAppData');
            if (saved) {
                const parsedData = JSON.parse(saved);
                console.log('=== VERIFICACI√ìN DE localStorage ===');
                console.log('Datos en localStorage:', parsedData);

                // Verificar cada secci√≥n del estado
                const checks = {
                    'Configuraci√≥n Empresa': compareObjects(state.companyConfig, parsedData.companyConfig),
                    'Datos Cliente': compareObjects(state.clientData, parsedData.clientData),
                    'Materiales': compareArrays(state.materials, parsedData.materials),
                    'Gastos': compareArrays(state.expenses, parsedData.expenses),
                    'C√°lculos': compareObjects(state.calculations, parsedData.calculations),
                    'Idioma': state.idioma === parsedData.idioma,
                    'Moneda': state.moneda === parsedData.moneda
                };

                console.log('Resultados de comparaci√≥n:', checks);

                // Verificar campos espec√≠ficos del cliente
                console.log('=== CAMPOS DEL CLIENTE ===');
                Object.keys(state.clientData).forEach(key => {
                    const current = state.clientData[key];
                    const saved = parsedData.clientData ? parsedData.clientData[key] : undefined;
                    console.log(`${key}: Estado=${current} | Guardado=${saved} | Coincide=${current === saved}`);
                });

                return parsedData;
            } else {
                console.log('‚ùå No hay datos en localStorage');
                return null;
            }
        }

        // Funci√≥n auxiliar para comparar objetos
        function compareObjects(obj1, obj2) {
            if (!obj1 || !obj2) return false;
            return JSON.stringify(obj1) === JSON.stringify(obj2);
        }

        // Funci√≥n para poblar datos de prueba
        function populateTestData() {
            // Configuraci√≥n de empresa
            state.companyConfig = {
                empresa: 'Floral Dreams Test',
                direccion: 'Calle de Prueba 456, Ciudad Test',
                telefono: '555-9999',
                eslogan: 'Eslogan de prueba para verificaci√≥n',
                email: 'test@empresa.com',
                logoBase64: null
            };

            // Datos del cliente
            state.clientData = {
                nombre: 'Cliente de Prueba',
                tipoServicio: 'Decoraci√≥n de Evento',
                descripcion: 'Descripci√≥n detallada del servicio de prueba',
                fechaDecoracion: '2025-12-25',
                lugarDecoracion: 'Sal√≥n de Eventos Principal',
                email: 'cliente@test.com',
                contacto: 'Juan P√©rez',
                notas: 'Notas importantes para el evento',
                fechaCotizacion: '2025-11-20'
            };

            // Materiales de prueba
            state.materials = [
                { id: 1, concepto: 'Globos met√°licos premium', cantidad: 150, precioUnitario: 2500.50, subtotal: 375075 },
                { id: 2, concepto: 'Cintas decorativas doradas', cantidad: 75, precioUnitario: 1250.75, subtotal: 93806.25 }
            ];

            // Gastos de prueba
            state.expenses = [
                { id: 1, concepto: 'Transporte especializado', precio: 85000.00 },
                { id: 2, concepto: 'Herramientas profesionales', precio: 125000.50 }
            ];

            // C√°lculos de prueba con valores grandes
            state.calculations = {
                nombreImpuesto: 'IVA',
                cantidad: 225,
                costoUnitario: 1875.25,
                tasaImpuesto: 19,
                tipoImpuesto: 'excluido',
                manoObraPct: 30,
                rentabilidadPct: 45,
                asistente1: 150000.00,
                asistente2: 120000.50,
                asistente3: 0,
                asistente4: 0
            };

            // Configuraci√≥n
            state.idioma = 'es';
            state.moneda = 'COP';

            updateUI();
            updateLanguage();
            console.log('‚úÖ Datos de prueba cargados en el estado');
        }

        // Funci√≥n para limpiar localStorage
        function clearLocalStorage() {
            localStorage.removeItem('balloonsAppData');
            console.log('üóëÔ∏è localStorage limpiado');
        }

        // Funci√≥n simplificada de debug
        function debugInfo() {
            console.log('Debug: Sistema funcionando correctamente');
        }

        // Mostrar mensajes de estado al usuario
        function showMessage(text, type) {
            const status = document.getElementById('messageStatus');
            status.textContent = text;
            status.className = `mt-4 p-2 rounded ${type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`;
            setTimeout(() => status.textContent = '', 3000);
        }

        // Actualizar la interfaz de usuario con los datos del estado
        function updateUI() {
            // Configuraci√≥n de empresa
            document.getElementById('empresa').value = state.companyConfig.empresa;
            document.getElementById('telefono').value = state.companyConfig.telefono;
            document.getElementById('direccion').value = state.companyConfig.direccion;
            document.getElementById('email').value = state.companyConfig.email;
            document.getElementById('eslogan').value = state.companyConfig.eslogan;
            // Mostrar preview del logo si existe
            const logoPreview = document.getElementById('logoPreview');
            if (state.companyConfig.logoBase64) {
                logoPreview.innerHTML = `<img src="${state.companyConfig.logoBase64}" alt="Logo" class="max-w-32 max-h-32 border rounded">`;
            } else {
                logoPreview.innerHTML = '';
            }
            document.getElementById('idioma').value = state.idioma;
            document.getElementById('moneda').value = state.moneda;

            // Datos del cliente
            document.getElementById('clienteNombre').value = state.clientData.nombre;
            document.getElementById('tipoServicio').value = state.clientData.tipoServicio;
            document.getElementById('descripcion').value = state.clientData.descripcion;
            document.getElementById('fechaDecoracion').value = state.clientData.fechaDecoracion;
            document.getElementById('lugarDecoracion').value = state.clientData.lugarDecoracion;
            document.getElementById('clienteEmail').value = state.clientData.email;
            document.getElementById('contacto').value = state.clientData.contacto;
            document.getElementById('notas').value = state.clientData.notas;
            document.getElementById('fechaCotizacion').value = state.clientData.fechaCotizacion;

            // Par√°metros de c√°lculo
            document.getElementById('manoObraPctInput').value = state.calculations.manoObraPct;
            document.getElementById('rentabilidadPct').value = state.calculations.rentabilidadPct;
            document.getElementById('nombreImpuesto').value = state.calculations.nombreImpuesto;
            document.getElementById('tasaImpuesto').value = state.calculations.tasaImpuesto;
            document.getElementById('tipoImpuesto').value = state.calculations.tipoImpuesto;
            document.getElementById('nombreImpuesto2').value = state.calculations.nombreImpuesto2;
            document.getElementById('tasaImpuesto2').value = state.calculations.tasaImpuesto2;
            document.getElementById('tipoImpuesto2').value = state.calculations.tipoImpuesto2;
            document.getElementById('asistente1').value = state.calculations.asistente1;
            document.getElementById('asistente2').value = state.calculations.asistente2;
            document.getElementById('asistente3').value = state.calculations.asistente3;
            document.getElementById('asistente4').value = state.calculations.asistente4;

            renderMaterials();
            renderExpenses();
            calculateResults();
        }

        // Renderizar la lista de materiales en la interfaz
        function renderMaterials() {
            const list = document.getElementById('materialsList');
            list.innerHTML = '';
            const t = uiTranslations[state.idioma] || uiTranslations.es;

            state.materials.forEach((mat, index) => {
                const div = document.createElement('div');
                div.className = 'flex gap-2 mb-4 p-3 bg-gray-50 rounded items-end';
                div.innerHTML = `
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">${t.materialConcept}:</label>
                        <input class="input-field w-full" value="${mat.concepto}" onchange="updateMaterial(${index}, 'concepto', this.value)">
                    </div>
                    <div class="w-20">
                        <label class="block text-sm font-medium text-gray-700 mb-1">${t.materialQuantity}:</label>
                        <input class="input-field w-full" type="number" value="${mat.cantidad}" onchange="updateMaterial(${index}, 'cantidad', this.value)">
                    </div>
                    <div class="w-28">
                        <label class="block text-sm font-medium text-gray-700 mb-1">${t.materialUnitPrice}:</label>
                        <input class="input-field w-full" type="number" step="0.01" value="${mat.precioUnitario}" onchange="updateMaterial(${index}, 'precioUnitario', this.value)">
                    </div>
                    <div class="w-28">
                        <label class="block text-sm font-medium text-gray-700 mb-1">${t.materialSubtotal}:</label>
                        <span class="px-3 py-2 bg-white border border-gray-300 rounded w-full inline-block text-center font-medium">${formatNumber(mat.subtotal)}</span>
                    </div>
                    <div class="w-12">
                        <button class="bg-red-500 text-white px-2 py-2 rounded w-full h-10 flex items-center justify-center" onclick="removeMaterial(${index})">X</button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        // Renderizar la lista de gastos indirectos en la interfaz
        function renderExpenses() {
            const list = document.getElementById('expensesList');
            list.innerHTML = '';
            const t = uiTranslations[state.idioma] || uiTranslations.es;

            state.expenses.forEach((exp, index) => {
                const div = document.createElement('div');
                div.className = 'flex gap-2 mb-4 p-3 bg-gray-50 rounded items-end';
                div.innerHTML = `
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">${t.expenseConcept}:</label>
                        <input class="input-field w-full" value="${exp.concepto}" onchange="updateExpense(${index}, 'concepto', this.value)">
                    </div>
                    <div class="w-32">
                        <label class="block text-sm font-medium text-gray-700 mb-1">${t.expensePrice}:</label>
                        <input class="input-field w-full" type="number" step="0.01" value="${exp.precio}" onchange="updateExpense(${index}, 'precio', this.value)">
                    </div>
                    <div class="w-12">
                        <button class="bg-red-500 text-white px-2 py-2 rounded w-full h-10 flex items-center justify-center" onclick="removeExpense(${index})">X</button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        // Calcular los resultados financieros del cotizador
        function calculateResults() {
            const totalMateriales = state.materials.reduce((sum, mat) => sum + mat.subtotal, 0);
            const totalManoObra = totalMateriales * (state.calculations.manoObraPct / 100);
            const totalAsistentes = state.calculations.asistente1 + state.calculations.asistente2 + state.calculations.asistente3 + state.calculations.asistente4;
            const totalGastos = state.expenses.reduce((sum, exp) => sum + exp.precio, 0);
            const totalCostos = totalMateriales + totalManoObra + totalAsistentes;
            const miGanancia = totalCostos * (state.calculations.rentabilidadPct / 100);
            const subtotalFinal = totalCostos + miGanancia;
            const precioBase = subtotalFinal + totalGastos;
            let baseImponible, impuesto, precioFinal;
            if (state.calculations.tipoImpuesto === 'noimpuesto') {
                baseImponible = precioBase;
                impuesto = 0;
                precioFinal = precioBase;
            } else {
                const tasa = state.calculations.tasaImpuesto / 100;
                if (state.calculations.tipoImpuesto === 'incluido') {
                    baseImponible = precioBase / (1 + tasa);
                    impuesto = precioBase - baseImponible;
                    precioFinal = precioBase;
                } else {
                    baseImponible = precioBase;
                    impuesto = precioBase * tasa;
                    precioFinal = precioBase + impuesto;
                }
            }

            let baseImponible2, impuesto2;
            if (state.calculations.tipoImpuesto2 === 'noimpuesto') {
                baseImponible2 = precioBase;
                impuesto2 = 0;
            } else {
                const tasa2 = state.calculations.tasaImpuesto2 / 100;
                if (state.calculations.tipoImpuesto2 === 'incluido') {
                    // Para simplificar, tratar como excluido si hay dos impuestos
                    baseImponible2 = precioBase/ (1 + tasa2);
                    impuesto2 = precioBase - baseImponible2;
                    // No sumar a precioFinal aqu√≠, ya que incluido no aplica bien con m√∫ltiples
                } else {
                    baseImponible2 = precioBase;
                    impuesto2 = precioBase * tasa2;
                }
            }
            precioFinal += impuesto2;

            const results = {
                totalMateriales,
                totalManoObra,
                totalAsistentes,
                totalGastos,
                totalCostos,
                miGanancia,
                subtotalFinal,
                baseImponible,
                impuesto,
                baseImponible2,
                impuesto2,
                precioFinal
            };

            // Actualizar la tabla de mano de obra
            document.getElementById('totalMaterialesDisplay').textContent = formatCurrency(totalMateriales);
            document.getElementById('totalManoObraDisplay').textContent = formatCurrency(totalManoObra);

            // Actualizar la tabla de liquidaci√≥n de rentabilidad
            document.getElementById('totalCostosDisplay').textContent = formatCurrency(totalCostos);
            document.getElementById('miGananciaDisplay').textContent = formatCurrency(miGanancia);
            document.getElementById('subtotalFinalDisplay').textContent = formatCurrency(subtotalFinal);
            document.getElementById('gastosAdicionalesDisplay').textContent = formatCurrency(totalGastos);
            document.getElementById('valorTotalDisplay').textContent = formatCurrency(precioBase);

            document.getElementById('totalConImpuestoGrande').textContent = formatCurrency(results.precioFinal);

            document.getElementById('baseImponibleDisplay').textContent = formatCurrency(results.baseImponible);
            document.getElementById('impuestoDisplay').textContent = state.calculations.tipoImpuesto === 'noimpuesto' ? '0' : `${formatCurrency(results.impuesto)}`;
            document.getElementById('baseImponibleDisplay2').textContent = formatCurrency(results.baseImponible2);
            document.getElementById('impuestoDisplay2').textContent = state.calculations.tipoImpuesto2 === 'noimpuesto' ? '0' : `${formatCurrency(results.impuesto2)}`;

            return results;
        }

        // Formatear montos de dinero seg√∫n la moneda seleccionada
        function formatCurrency(amount) {
            const symbols = { COP: '$', USD: '$', EUR: '‚Ç¨', CAD: 'C$', GBP: '¬£' };
            const symbol = symbols[state.moneda] || '$';

            // Formatear con separador de miles y 2 decimales
            const formattedNumber = new Intl.NumberFormat('es-CO', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);

            return `${symbol}${formattedNumber} ${state.moneda}`;
        }

        // Formatear n√∫meros con separador de miles y decimales
        function formatNumber(value, decimals = 2) {
            if (value === null || value === undefined || isNaN(value)) return '0';
            return new Intl.NumberFormat('es-CO', {
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            }).format(value);
        }

        // Formatear porcentajes
        function formatPercentage(value) {
            if (value === null || value === undefined || isNaN(value)) return '0%';
            return `${formatNumber(value, 2)}%`;
        }

        // Actualizar un material espec√≠fico en el estado
        function updateMaterial(index, field, value) {
            if (field === 'cantidad' || field === 'precioUnitario') {
                value = parseFloat(value) || 0;
            }
            state.materials[index][field] = value;
            if (field === 'cantidad' || field === 'precioUnitario') {
                state.materials[index].subtotal = state.materials[index].cantidad * state.materials[index].precioUnitario;
            }
            renderMaterials();
            calculateResults();
        }

        // Eliminar un material de la lista
        function removeMaterial(index) {
            state.materials.splice(index, 1);
            renderMaterials();
            calculateResults();
        }

        // Actualizar un gasto indirecto espec√≠fico en el estado
        function updateExpense(index, field, value) {
            if (field === 'precio') {
                value = parseFloat(value) || 0;
            }
            state.expenses[index][field] = value;
            renderExpenses();
            calculateResults();
        }

        // Eliminar un gasto indirecto de la lista
        function removeExpense(index) {
            state.expenses.splice(index, 1);
            renderExpenses();
            calculateResults();
        }

        // Generar y descargar el PDF de la cotizaci√≥n
        function generatePDF() {
            console.log('Iniciando generaci√≥n de PDF...');
            if (!window.jspdf) {
                console.error('jsPDF no est√° cargado. Verifica la conexi√≥n a internet o descarga la librer√≠a localmente.');
                alert('Error: jsPDF no est√° disponible. Aseg√∫rate de tener conexi√≥n a internet para cargar la librer√≠a desde CDN.');
                return;
            }
            const t = uiTranslations[state.idioma] || uiTranslations.es;
            const status = document.getElementById('pdfStatus');
            status.textContent = t.generatingPDF;

            const results = calculateResults();

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Colores para el PDF
            const primaryColor = [139, 0, 139];
            const secondaryColor = [221, 160, 221];
            const textColor = [47, 47, 47];

            // Traducciones para el PDF
            const translations = {
                es: {
                    title: 'COTIZACI√ìN DE SERVICIOS',
                    clientInfo: 'INFORMACI√ìN DEL CLIENTE',
                    serviceDetails: 'DETALLES DEL SERVICIO',
                    costBreakdown: 'DESGLOSE DE COSTOS',
                    quoteDate: 'Fecha de Cotizaci√≥n',
                    decorationDate: 'Fecha de Decoraci√≥n',
                    client: 'Cliente',
                    location: 'Lugar',
                    email: 'Email',
                    contact: 'Contacto',
                    notes: 'Notas',
                    serviceType: 'Tipo de Decoraci√≥n',
                    description: 'Descripci√≥n',
                    concept: 'Concepto',
                    quantity: 'Cantidad',
                    unitPrice: 'Precio Unit.',
                    subtotal: 'Subtotal',
                    labor: 'Mano de Obra',
                    additionalCosts: 'Costos Adicionales',
                    totalCosts: 'Total Costos',
                    myProfit: 'Mi Ganancia',
                    decorationValue: 'Valor de la Decoraci√≥n',
                    finalPrice: 'PRECIO FINAL',
                    taxableBase: 'Base Imponible',
                    taxAmount: 'Impuestos',
                    totalWithTax: 'Total con Impuesto',
                    thanks: 'Gracias por su preferencia.',
                    contactUs: '¬øTiene alguna pregunta sobre esta cotizaci√≥n?, comunicate con nosotros para ayudarte.',
                    footerContact: 'Cont√°ctenos para darle una pronta respuesta.',
                    footerPhone: 'Tel√©fono',
                    notSpecified: 'No especificado',
                    materials: 'Materiales',
                    totalMaterials: 'Total Materiales',
                    totalAssistants: 'Total Asistentes',
                    totalExpenses: 'Total Gastos'
                },
                en: {
                    title: 'SERVICE QUOTATION',
                    clientInfo: 'CLIENT INFORMATION',
                    serviceDetails: 'SERVICE DETAILS',
                    costBreakdown: 'COST BREAKDOWN',
                    quoteDate: 'Quote Date',
                    decorationDate: 'Decoration Date',
                    client: 'Client',
                    location: 'Location',
                    email: 'Email',
                    contact: 'Contact',
                    notes: 'Notes',
                    serviceType: 'Service Type',
                    description: 'Description',
                    concept: 'Concept',
                    quantity: 'Quantity',
                    unitPrice: 'Unit Price',
                    subtotal: 'Subtotal',
                    labor: 'Labor',
                    additionalCosts: 'Additional Costs',
                    totalCosts: 'Total Costs',
                    myProfit: 'My Profit',
                    decorationValue: 'Decoration Value',
                    finalPrice: 'FINAL PRICE',
                    taxableBase: 'Taxable Base',
                    taxAmount: 'Tax Amount',
                    totalWithTax: 'Total with Tax',
                    thanks: 'Thank you for your preference. please contact us for any questions.',
                    contactUs: 'Contact us for a prompt response.',
                    footerContact: 'Contact us for a prompt response.',
                    footerPhone: 'Phone',
                    notSpecified: 'Not specified',
                    materials: 'Materials',
                    totalMaterials: 'Total Materials',
                    totalAssistants: 'Total Assistants',
                    totalExpenses: 'Total Expenses'
                },
                fr: {
                    title: 'DEVIS DE SERVICES',
                    clientInfo: 'INFORMATION CLIENT',
                    serviceDetails: 'D√âTAILS DU SERVICE',
                    costBreakdown: 'D√âTAIL DES CO√õTS',
                    quoteDate: 'Date de Devis',
                    decorationDate: 'Date de D√©coration',
                    client: 'Client',
                    location: 'Lieu',
                    email: 'Email',
                    contact: 'Contact',
                    notes: 'Notes',
                    serviceType: 'Type de Service',
                    description: 'Description',
                    concept: 'Concept',
                    quantity: 'Quantit√©',
                    unitPrice: 'Prix Unit.',
                    subtotal: 'Subtotal',
                    labor: 'Main d\'≈ìuvre',
                    additionalCosts: 'Co√ªts Additionnels',
                    totalCosts: 'Co√ªts Totaux',
                    myProfit: 'Mon Profit',
                    decorationValue: 'Valeur de la D√©coration',
                    finalPrice: 'PRIX FINAL',
                    taxableBase: 'Base Imposable',
                    taxAmount: 'Montant de l\'Imp√¥t',
                    totalWithTax: 'Total avec Imp√¥t',
                    thanks: 'Merci de votre pr√©f√©rence. veuillez nous contacter pour toute question.',
                    contactUs: 'Contactez-nous pour une r√©ponse rapide.',
                    footerContact: 'Contactez-nous pour une r√©ponse rapide.',
                    footerPhone: 'T√©l√©phone',
                    notSpecified: 'Non sp√©cifi√©',
                    materials: 'Mat√©riaux',
                    totalMaterials: 'Total Mat√©riaux',
                    totalAssistants: 'Total Assistants',
                    totalExpenses: 'Total D√©penses'
                }

            };

            const pdfT = translations[state.idioma] || translations.es;

            // Header - Company title
            doc.setFontSize(18);
            doc.setTextColor(...primaryColor);
            doc.setFont(undefined, 'bold');
            doc.text(state.companyConfig.empresa, 15, 30);

            // Agregar logo si existe
            if (state.companyConfig.logoBase64) {
                try {
                    doc.addImage(state.companyConfig.logoBase64, 'JPEG', 150, 10, 40, 40); // Posici√≥n y tama√±o del logo
                } catch (error) {
                    console.error('Error al agregar imagen al PDF:', error);
                }
            }

            doc.setFontSize(10);
            doc.setTextColor(...textColor);
            doc.setFont(undefined, 'normal');
            if (state.companyConfig.eslogan) {
                doc.setTextColor(...secondaryColor);
                doc.text(state.companyConfig.eslogan, 15, 35);
            }
            doc.setTextColor(...textColor);
            doc.text(state.companyConfig.direccion, 15, 45);
            doc.text(`Email: ${state.companyConfig.email} | ${pdfT.footerPhone}: ${state.companyConfig.telefono}`, 15, 50);
            // Title
            doc.setFontSize(20);
            doc.setTextColor(...primaryColor);
            doc.setFont(undefined, 'bold');
            doc.text(pdfT.title, 15, 65);

            // Client Info
         //   let y = 75;
            doc.setFontSize(10);
            doc.setTextColor(...textColor);
            doc.setFont(undefined, 'bold');
            doc.text(pdfT.clientInfo, 15, 74);
         //   y += 8;
            doc.setFont(undefined, 'normal');
            doc.text(`${pdfT.client}: ${state.clientData.nombre || pdfT.notSpecified}`, 15, 80);
            doc.text(`${pdfT.location}: ${state.clientData.lugarDecoracion || pdfT.notSpecified}`, 15, 85);
            doc.text(`${pdfT.email}: ${state.clientData.email || pdfT.notSpecified}`, 15, 90);
            doc.text(`${pdfT.contact}: ${state.clientData.contacto || pdfT.notSpecified}`, 15, 95);

          //  Fechas - A la derecha
            doc.text(`${pdfT.decorationDate}:`, 150, 80);
            doc.text(`${state.clientData.fechaDecoracion || pdfT.notSpecified}`, 155, 85);
            doc.text(`${pdfT.quoteDate}:`, 150, 90);
            doc.text(`${state.clientData.fechaCotizacion || pdfT.notSpecified}`, 155, 95);

            // Service Details
            y = 105;
            doc.setFont(undefined, 'bold');
            doc.text(pdfT.serviceDetails, 15, y);
            y += 8;
            doc.setFont(undefined, 'normal');
            doc.text(`${pdfT.serviceType}: ${state.clientData.tipoServicio || pdfT.notSpecified}`, 15, y);
            y += 8;
            const descText = `${pdfT.description}: ${state.clientData.descripcion || pdfT.notSpecified}`;
 
            const descLines = doc.splitTextToSize(descText, 175);
            doc.text(descLines, 15, y);
            y += descLines.length * 4.5;
        
            if (state.clientData.notas) {
                const notesText = `${pdfT.notes}: ${state.clientData.notas}`;
                const notesLines = doc.splitTextToSize(notesText, 175);
                doc.text(notesLines, 15, y);
                y += notesLines.length * 4.5;
            }

            // Results
            y += 8;
            doc.setFont(undefined, 'bold');
            doc.text(pdfT.costBreakdown, 15, y);
            y += 8;
            doc.setFont(undefined, 'normal');
            doc.setFont(undefined, 'normal');
            doc.text(`${pdfT.decorationValue}:`, 30, y); 
            doc.text(`${formatCurrency(results.subtotalFinal)}`, 130, y);
        //    doc.text(`${pdfT.totalMaterials}: ${formatCurrency(results.totalMateriales)}`, 15, y); y += 5;
        //    doc.text(`${pdfT.labor}: ${formatCurrency(results.totalManoObra)}`, 15, y); y += 5;
        //    doc.text(`${pdfT.totalAssistants}: ${formatCurrency(results.totalAsistentes)}`, 15, y); y += 5;
        //    doc.text(`${pdfT.totalExpenses}: ${formatCurrency(results.totalGastos)}`, 15, y); y += 5;
        //    doc.text(`${pdfT.totalCosts}: ${formatCurrency(results.totalCostos)}`, 15, y); y += 5;
        //    doc.text(`${pdfT.myProfit}: ${formatCurrency(results.miGanancia)}`, 15, y); y += 5;

            // Expenses
            y += 8;
            doc.setFont(undefined, 'bold');
            doc.text(pdfT.additionalCosts + ':', 15, y);
            y += 8;
            doc.setFont(undefined, 'normal');
            state.expenses.forEach(exp => {
                doc.text(`${exp.concepto}:`, 30, y);
                doc.text(`${formatCurrency(exp.precio)}`, 130, y);
                y += 5;
            });
            // IMPUESTOS Y TOTAL
            y += 3;
            doc.setFont(undefined, 'bold');
            doc.text(pdfT.taxAmount + ':', 15, y);
            y += 5;
            doc.setFont(undefined, 'normal');
            doc.text(`${pdfT.taxableBase}:`, 30, y); 
            doc.text(`${formatCurrency(results.baseImponible)}`, 130, y); y += 5;
            if (state.calculations.tipoImpuesto !== 'noimpuesto') {
                doc.text(`${state.calculations.nombreImpuesto} (${state.calculations.tasaImpuesto}%):`, 30, y);
                doc.text(`${formatCurrency(results.impuesto)}`, 130, y); y += 5;
            }
            if (state.calculations.tipoImpuesto2 !== 'noimpuesto') {
                doc.text(`${state.calculations.nombreImpuesto2} (${state.calculations.tasaImpuesto2}%):`, 30, y);
                doc.text(`${formatCurrency(results.impuesto2)}`, 130, y); y += 5;
            }
            y += 8;
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text(`${pdfT.finalPrice} ${formatCurrency(results.precioFinal)}`, 40, y);

            // Footer
            
            y += 18;
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.setTextColor(...secondaryColor);
            const pageWidth = doc.internal.pageSize.getWidth();
            const thanksWidth = doc.getTextWidth(pdfT.thanks);
            const thanksX = (pageWidth - thanksWidth) / 2;
            doc.text(pdfT.thanks, thanksX, y);
            y += 5;
            const contactWidth = doc.getTextWidth(pdfT.contactUs);
            const contactX = (pageWidth - contactWidth) / 2;
            doc.text(pdfT.contactUs, contactX, y);

            // Download
            doc.save(`cotizacion-${state.clientData.nombre || 'globos'}-${new Date().toISOString().split('T')[0]}.pdf`);
            status.textContent = t.pdfGenerated;
        }

        // Event listeners para manejar interacciones del usuario
        document.addEventListener('DOMContentLoaded', loadData);

        // Bot√≥n para guardar datos
        document.getElementById('saveDataBtn').addEventListener('click', saveData);

        // Cambios en las tabs
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active', 'border-b-2', 'border-pink-500', 'text-pink-600'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active', 'border-b-2', 'border-pink-500', 'text-pink-600');
                document.getElementById(btn.dataset.tab).classList.add('active');
            });
        });

        // Cambios en la configuraci√≥n de empresa
        ['empresa', 'telefono', 'direccion', 'email', 'eslogan'].forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => {
                state.companyConfig[id] = e.target.value;
            });
        });
        // Evento para cargar imagen del logo
        document.getElementById('logo').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    state.companyConfig.logoBase64 = event.target.result;
                    updateUI(); // Actualizar preview
                };
                reader.readAsDataURL(file);
            }
        });
        document.getElementById('idioma').addEventListener('change', (e) => {
            state.idioma = e.target.value;
            updateLanguage();
        });
        document.getElementById('moneda').addEventListener('change', (e) => {
            state.moneda = e.target.value;
        });

        // Cambios en los datos del cliente
        const clientFieldMap = {
            clienteNombre: 'nombre',
            tipoServicio: 'tipoServicio',
            descripcion: 'descripcion',
            fechaDecoracion: 'fechaDecoracion',
            lugarDecoracion: 'lugarDecoracion',
            clienteEmail: 'email',
            contacto: 'contacto',
            notas: 'notas',
            fechaCotizacion: 'fechaCotizacion'
        };
        ['clienteNombre', 'tipoServicio', 'descripcion', 'fechaDecoracion', 'lugarDecoracion', 'clienteEmail', 'contacto', 'notas', 'fechaCotizacion'].forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => {
                state.clientData[clientFieldMap[id]] = e.target.value;
            });
        });

        // Cambios en los par√°metros de c√°lculo
        ['tasaImpuesto', 'tasaImpuesto2', 'rentabilidadPct', 'asistente1', 'asistente2', 'asistente3', 'asistente4'].forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => {
                state.calculations[id] = parseFloat(e.target.value) || 0;
                calculateResults();
            });
        });
        document.getElementById('manoObraPctInput').addEventListener('input', (e) => {
            state.calculations.manoObraPct = parseFloat(e.target.value) || 0;
            calculateResults();
        });
        document.getElementById('tipoImpuesto').addEventListener('change', (e) => {
            state.calculations.tipoImpuesto = e.target.value;
            calculateResults();
        });
        document.getElementById('nombreImpuesto').addEventListener('input', (e) => {
            state.calculations.nombreImpuesto = e.target.value;
            calculateResults();
        });
        document.getElementById('tasaImpuesto2').addEventListener('input', (e) => {
            state.calculations.tasaImpuesto2 = parseFloat(e.target.value) || 0;
            calculateResults();
        });
        document.getElementById('tipoImpuesto2').addEventListener('change', (e) => {
            state.calculations.tipoImpuesto2 = e.target.value;
            calculateResults();
        });
        document.getElementById('nombreImpuesto2').addEventListener('input', (e) => {
            state.calculations.nombreImpuesto2 = e.target.value;
            calculateResults();
        });

        // Botones para agregar materiales y gastos
        document.getElementById('addMaterial').addEventListener('click', () => {
            state.materials.push({ id: Date.now(), concepto: 'Nuevo Material', cantidad: 1, precioUnitario: 0, subtotal: 0 });
            renderMaterials();
            calculateResults();
        });
        document.getElementById('addExpense').addEventListener('click', () => {
            state.expenses.push({ id: Date.now(), concepto: 'Nuevo Gasto', precio: 0 });
            renderExpenses();
            calculateResults();
        });

        // Bot√≥n para generar PDF
        document.getElementById('generatePDF').addEventListener('click', generatePDF);

        // Bot√≥n de debug para verificar localStorage
        document.getElementById('debugBtn').addEventListener('click', () => {
            const debugData = debugLocalStorage();
            const debugStatus = document.getElementById('debugStatus');
            if (debugData) {
                debugStatus.innerHTML = `
                    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded">
                        <strong>‚úÖ Datos encontrados en localStorage</strong><br>
                        <small>Revisa la consola del navegador (F12) para ver los detalles completos</small>
                    </div>
                `;
            } else {
                debugStatus.innerHTML = `
                    <div class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded">
                        <strong>‚ö†Ô∏è No hay datos guardados</strong><br>
                        <small>Guarda algunos datos primero usando el bot√≥n "Guardar Datos"</small>
                    </div>
                `;
            }
        });

        // Bot√≥n para cargar datos de prueba
        document.getElementById('testDataBtn').addEventListener('click', () => {
            populateTestData();
            const debugStatus = document.getElementById('debugStatus');
            debugStatus.innerHTML = `
                <div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded">
                    <strong>üîÑ Datos de prueba cargados</strong><br>
                    <small>Ahora guarda los datos y verifica que se persistan correctamente</small>
                </div>
            `;
        });

        // Bot√≥n para limpiar datos
        document.getElementById('clearDataBtn').addEventListener('click', () => {
            clearLocalStorage();
            const debugStatus = document.getElementById('debugStatus');
            debugStatus.innerHTML = `
                <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                    <strong>üóëÔ∏è Datos limpiados</strong><br>
                    <small>localStorage ha sido limpiado completamente</small>
                </div>
            `;
        });

        // Bot√≥n para verificar formato de n√∫meros
        document.getElementById('formatBtn').addEventListener('click', () => {
            debugInfo();
            const debugStatus = document.getElementById('debugStatus');
            debugStatus.innerHTML = `
                <div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded">
                    <strong>üî¢ Sistema verificado</strong><br>
                    <small>Revisa la consola del navegador para informaci√≥n de debug</small>
                </div>
            `;
        });

        // Bot√≥n para verificar traducciones de labels
        document.getElementById('labelsBtn').addEventListener('click', () => {
            debugInfo();
            const debugStatus = document.getElementById('debugStatus');
            debugStatus.innerHTML = `
                <div class="bg-purple-100 border border-purple-400 text-purple-700 px-4 py-3 rounded">
                    <strong>üè∑Ô∏è Labels verificadas</strong><br>
                    <small>Las traducciones de labels est√°n funcionando correctamente</small>
                </div>
            `;
        });

        // Hacer funciones disponibles globalmente para testing desde consola
        window.debugLocalStorage = debugLocalStorage;
        window.populateTestData = populateTestData;
        window.clearLocalStorage = clearLocalStorage;
        window.debugInfo = debugInfo;
        window.formatCurrency = formatCurrency;
        window.formatNumber = formatNumber;
        window.formatPercentage = formatPercentage;
    </script>
    <!-- Fin del c√≥digo JavaScript -->
</body>
</html>
